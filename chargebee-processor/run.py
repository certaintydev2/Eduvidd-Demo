import json

from chargebee_processor.main import handler

if __name__ == '__main__':

    #body = {'id': 'ev_AzqYVpSQr8MDKrN', 'occurred_at': 1615011187, 'source': 'admin_console', 'user': 'cb-ui-middleware', 'object': 'event', 'api_version': 'v2', 'content': {'subscription': {'id': 'AzqYVpSQr7cbtqR', 'billing_period': 1, 'billing_period_unit': 'year', 'customer_id': 'AzZl4ESQlSmkBtl', 'status': 'active', 'current_term_start': 1615011012, 'current_term_end': 1646547012, 'next_billing_at': 1646547012, 'created_at': 1615011012, 'started_at': 1615011012, 'activated_at': 1615011012, 'updated_at': 1615011187, 'has_scheduled_changes': False, 'resource_version': 1615011187462, 'deleted': False, 'object': 'subscription', 'currency_code': 'AUD', 'subscription_items': [{'item_price_id': 'npaq-st-a', 'item_type': 'plan', 'quantity': 1, 'unit_price': 500, 'amount': 500, 'free_quantity': 0, 'object': 'subscription_item'}, {'item_price_id': 'cpd-aud-monthly', 'item_type': 'addon', 'quantity': 1, 'unit_price': 1000, 'amount': 1000, 'object': 'subscription_item'}], 'due_invoices_count': 0, 'mrr': 42, 'exchange_rate': 1.0, 'base_currency_code': 'AUD'}, 'customer': {'id': 'AzZl4ESQlSmkBtl', 'first_name': 'Vijeet', 'last_name': 'Agrawal', 'email': 'xyz@gmail.com', 'auto_collection': 'on', 'net_term_days': 0, 'allow_direct_debit': False, 'created_at': 1614927398, 'created_from_ip': '3.233.249.52', 'taxability': 'taxable', 'updated_at': 1615011187, 'locale': 'en', 'pii_cleared': 'active', 'resource_version': 1615011187010, 'deleted': False, 'object': 'customer', 'billing_address': {'country': 'IN', 'validation_status': 'not_validated', 'object': 'billing_address'}, 'card_status': 'valid', 'promotional_credits': 0, 'refundable_credits': 0, 'excess_payments': 0, 'unbilled_charges': 0, 'preferred_currency_code': 'AUD', 'primary_payment_source_id': 'pm_AzZl4ESQlVjJn16f', 'payment_method': {'object': 'payment_method', 'type': 'card', 'reference_id': 'tok_AzZl4ESQlVjJT16e', 'gateway': 'chargebee', 'gateway_account_id': 'gw_1mbDWgbR0vSsLof9T', 'status': 'valid'}}, 'card': {'status': 'valid', 'gateway': 'chargebee', 'gateway_account_id': 'gw_1mbDWgbR0vSsLof9T', 'first_name': 'oep', 'last_name': 'Chargebee', 'iin': '411111', 'last4': '1111', 'card_type': 'visa', 'funding_type': 'credit', 'expiry_month': 12, 'expiry_year': 2022, 'created_at': 1614928100, 'updated_at': 1614928100, 'resource_version': 1614928100153, 'object': 'card', 'masked_number': '************1111', 'customer_id': 'AzZl4ESQlSmkBtl', 'payment_source_id': 'pm_AzZl4ESQlVjJn16f'}, 'invoice': {'id': '13', 'customer_id': 'AzZl4ESQlSmkBtl', 'subscription_id': 'AzqYVpSQr7cbtqR', 'recurring': True, 'status': 'paid', 'price_type': 'tax_inclusive', 'date': 1615011186, 'due_date': 1615011186, 'net_term_days': 0, 'exchange_rate': 1.0, 'total': 12000, 'amount_paid': 7455, 'amount_adjusted': 0, 'write_off_amount': 0, 'credits_applied': 4545, 'amount_due': 0, 'paid_at': 1615011187, 'updated_at': 1615011187, 'resource_version': 1615011187434, 'deleted': False, 'object': 'invoice', 'first_invoice': False, 'amount_to_collect': 0, 'round_off_amount': 0, 'has_advance_charges': False, 'currency_code': 'AUD', 'base_currency_code': 'AUD', 'is_gifted': False, 'term_finalized': True, 'tax': 0, 'line_items': [{'id': 'li_AzqYVpSQr8Lpjr4', 'date_from': 1615011186, 'date_to': 1646547012, 'unit_amount': 12000, 'quantity': 1, 'amount': 12000, 'pricing_model': 'flat_fee', 'is_taxed': False, 'tax_amount': 0, 'object': 'line_item', 'subscription_id': 'AzqYVpSQr7cbtqR', 'customer_id': 'AzZl4ESQlSmkBtl', 'description': 'CPD - Prorated Charges', 'entity_type': 'addon_item_price', 'entity_id': 'cpd-aud-monthly', 'entity_description': 'Continuing professional development for monthly union memberships.', 'tax_exempt_reason': 'export', 'discount_amount': 0, 'item_level_discount_amount': 0}], 'sub_total': 12000, 'linked_payments': [{'txn_id': 'txn_AzqYVpSQr8M2vr9', 'applied_amount': 7455, 'applied_at': 1615011187, 'txn_status': 'success', 'txn_date': 1615011187, 'txn_amount': 7455}], 'dunning_attempts': [], 'applied_credits': [{'applied_amount': 1602, 'applied_at': 1615011186, 'cn_id': 'TEST-CN-1', 'cn_reason_code': 'subscription_change', 'cn_create_reason_code': 'Subscription Change', 'cn_date': 1614929252, 'cn_status': 'refunded'}, {'applied_amount': 999, 'applied_at': 1615011186, 'cn_id': 'TEST-CN-2', 'cn_reason_code': 'subscription_change', 'cn_create_reason_code': 'Subscription Change', 'cn_date': 1614933261, 'cn_status': 'refunded'}, {'applied_amount': 975, 'applied_at': 1615011186, 'cn_id': 'TEST-CN-3', 'cn_reason_code': 'subscription_change', 'cn_create_reason_code': 'Subscription Change', 'cn_date': 1615010369, 'cn_status': 'refunded'}, {'applied_amount': 969, 'applied_at': 1615011186, 'cn_id': 'TEST-CN-4', 'cn_reason_code': 'subscription_change', 'cn_create_reason_code': 'Subscription Change', 'cn_date': 1615010873, 'cn_status': 'refunded'}], 'adjustment_credit_notes': [], 'issued_credit_notes': [], 'linked_orders': [], 'billing_address': {'first_name': 'Vijeet', 'last_name': 'Agrawal', 'country': 'IN', 'validation_status': 'not_validated', 'object': 'billing_address'}}}, 'event_type': 'subscription_changed', 'webhook_status': 'scheduled', 'webhooks': [{'id': 'whv2_16BjsPSQfvdGn4Qs', 'webhook_status': 'scheduled', 'object': 'webhook'}, {'id': 'whv2_AzZm2iSNvzaGV3x4', 'webhook_status': 'scheduled', 'object': 'webhook'}]}

    the_event = dict(Records=[dict(body=json.dumps(body))],)

    the_context = None
    resp = handler(the_event, the_context)
    # print(resp)
